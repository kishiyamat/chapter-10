---
title: "Generalized Linear Model"
author: "Takeshi Kishiyama"
date: '`r format(Sys.time(), "%Y/%m/%d %H:%M")`'
output: ioslides_presentation
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
    message = FALSE,
    cache = FALSE,
    warning = FALSE,
    width=6,
    fig.align='center',
    fig.pos='H',
    dev = c("png", "svg")
)
# knitr::opts_chunk$set(echo=FALSE)
library(DiagrammeR)
library(tidyverse)
library(lubridate)
library(magrittr)
library(ggplot2)
library(DT)
library(rmarkdown)
'%r+%' <- function(a,b) rbind(a,b)
library("dplyr")
library("stringr")
```

# **8章と9章**

## 今日のテーマ

* R入門（関数型のアプローチ）
* **8章と9章**
* 10章
    
## 8章と9章

* **相関関係と因果関係の違い(交絡変数は触れたい)**
    * 見た目は似てるけど...?
* 線形回帰のパラメータ推定
    * さっきの `optim` を実際に利用（GLMのウォーミングアップ）
* 線形回帰が解決できる／できない問題
    * できない問題、GLMならできます。

## 相関関係と因果関係の違い

線形回帰の前に、以下の２つのどちらが相関で因果？

```{r plot, fig.height=3}
layout(matrix(1:2, ncol=2)) 
# 木の高さ体積の関係(図左)
plot(x=trees$Height, y=trees$Volume)
# 車の時速と停止距離の関係(図右)
plot(x=cars$speed, y=cars$dist)
```

## 相関関係と因果関係の違い

* 相関: X(height)とY(volume)の2変量の間の関連性
    * Xを変えてもYは変わらない。
* 因果: X(speed)がY(distance)を説明
    * Xを変えるとYも変動しそう。
    * $\to$ **XはYを説明** し、 **YはXに応答(依存、従属)**

```{r, echo=FALSE, fig.height=2}
grViz("

digraph boxes_and_circles {

  # a 'graph' statement
  graph [overlap = true, fontsize = 8]

  # several 'node' statements
  node [shape = box,
        fontname = Helvetica]
  height; volume; confounding_factors;
  speed; distance;

  # several 'edge' statements
  confounding_factors -> height
  confounding_factors -> volume
  speed -> distance

}

")
```

## 因果関係と線形回帰

* 因果: X(speed)がY(distance)を説明
    * 判断基準: Hill(1965)の抜粋
        * A $\to$ Bの相関強い？ 
        * A $\to$ Bは時系列に沿ってる？
        * A $\to$ Bは他の知見と比べて妥当？
    * $\hat{Y}_i = a + b X_i$

## 因果関係のガイドライン


## ここまでの参考書

* 因果推論

## 交絡

```{r}
grViz("
digraph boxes_and_circles {

  # a 'graph' statement
  graph [overlap = true, fontsize = 10]

  # several 'node' statements
  node [shape = box,
        fontname = Helvetica]
  Height; Volume; 木の種類や樹齢、環境など;

  # several 'edge' statements
  木の種類や樹齢、環境など -> Height
  木の種類や樹齢、環境など -> Volume

}
")
```


```{r}
head(cars)
head(trees)
plot(cars)
```

## 線形回帰のパラメータ推定

## 線形回帰が解決できる／できない問題
